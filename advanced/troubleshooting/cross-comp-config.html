<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Cross Stack Misconfiguration - Hermes (IBC Relayer CLI) Documentation</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><li class="part-title">Hermes v1.0.0</li><li class="spacer"></li><li class="chapter-item expanded "><a href="../../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../../quick-start/index.html"><strong aria-hidden="true">2.</strong> Quick start</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../quick-start/pre-requisites.html"><strong aria-hidden="true">2.1.</strong> Prerequisites</a></li><li class="chapter-item expanded "><a href="../../quick-start/installation.html"><strong aria-hidden="true">2.2.</strong> Installation</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/index.html"><strong aria-hidden="true">3.</strong> Tutorials</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../tutorials/pre-requisites/index.html"><strong aria-hidden="true">3.1.</strong> Prerequisites for local chains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../tutorials/pre-requisites/gaia.html"><strong aria-hidden="true">3.1.1.</strong> Install Gaia</a></li><li class="chapter-item expanded "><a href="../../tutorials/pre-requisites/gaiad-manager.html"><strong aria-hidden="true">3.1.2.</strong> Install Gaiad Manager</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/local-chains/index.html"><strong aria-hidden="true">3.2.</strong> Local chains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../tutorials/local-chains/start-local-chains.html"><strong aria-hidden="true">3.2.1.</strong> Start the local chains</a></li><li class="chapter-item expanded "><a href="../../tutorials/local-chains/add-a-new-relay-path.html"><strong aria-hidden="true">3.2.2.</strong> Add a new relay path</a></li><li class="chapter-item expanded "><a href="../../tutorials/local-chains/start-relaying.html"><strong aria-hidden="true">3.2.3.</strong> Start relaying</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/more-chains/index.html"><strong aria-hidden="true">3.3.</strong> More Local Chains</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../tutorials/more-chains/start-local-chains.html"><strong aria-hidden="true">3.3.1.</strong> Start the local chains</a></li><li class="chapter-item expanded "><a href="../../tutorials/more-chains/build-the-topology.html"><strong aria-hidden="true">3.3.2.</strong> Build the topology</a></li><li class="chapter-item expanded "><a href="../../tutorials/more-chains/start-relaying.html"><strong aria-hidden="true">3.3.3.</strong> Start relaying</a></li><li class="chapter-item expanded "><a href="../../tutorials/more-chains/concurrent-instances.html"><strong aria-hidden="true">3.3.4.</strong> Add new instances of Hermes</a></li></ol></li><li class="chapter-item expanded "><a href="../../tutorials/production/index.html"><strong aria-hidden="true">3.4.</strong> Relaying in production</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../tutorials/production/setup-grafana.html"><strong aria-hidden="true">3.4.1.</strong> Set up the monitoring platform</a></li><li class="chapter-item expanded "><a href="../../tutorials/production/setup-hermes.html"><strong aria-hidden="true">3.4.2.</strong> Set up Hermes</a></li><li class="chapter-item expanded "><a href="../../tutorials/production/start-relaying.html"><strong aria-hidden="true">3.4.3.</strong> Start relaying</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../advanced/index.html"><strong aria-hidden="true">4.</strong> Advanced</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../advanced/features.html"><strong aria-hidden="true">4.1.</strong> Features</a></li><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/index.html"><strong aria-hidden="true">4.2.</strong> Troubleshooting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/help-command.html"><strong aria-hidden="true">4.2.1.</strong> Help Command</a></li><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/profiling.html"><strong aria-hidden="true">4.2.2.</strong> Profiling</a></li><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/log-level.html"><strong aria-hidden="true">4.2.3.</strong> Log level</a></li><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/patch-gaia.html"><strong aria-hidden="true">4.2.4.</strong> Patch Gaia</a></li><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/inspect.html"><strong aria-hidden="true">4.2.5.</strong> Inspecting the relayer's state</a></li><li class="chapter-item expanded "><a href="../../advanced/troubleshooting/cross-comp-config.html" class="active"><strong aria-hidden="true">4.2.6.</strong> Cross Stack Misconfiguration</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/index.html"><strong aria-hidden="true">5.</strong> Documentation</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/configuration/index.html"><strong aria-hidden="true">5.1.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/configuration/configure-hermes.html"><strong aria-hidden="true">5.1.1.</strong> Configure Hermes</a></li><li class="chapter-item expanded "><a href="../../documentation/configuration/description.html"><strong aria-hidden="true">5.1.2.</strong> Description of the parameters</a></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/telemetry/index.html"><strong aria-hidden="true">5.2.</strong> Telemetry</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/telemetry/operators.html"><strong aria-hidden="true">5.2.1.</strong> Operators guide</a></li><li class="chapter-item expanded "><a href="../../documentation/telemetry/integration.html"><strong aria-hidden="true">5.2.2.</strong> Integration</a></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/rest-api.html"><strong aria-hidden="true">5.3.</strong> REST API</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/index.html"><strong aria-hidden="true">5.4.</strong> Commands Reference</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/commands/global.html"><strong aria-hidden="true">5.4.1.</strong> Global options and JSON output</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/keys/index.html"><strong aria-hidden="true">5.4.2.</strong> Keys</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/config.html"><strong aria-hidden="true">5.4.3.</strong> Config</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/path-setup/index.html"><strong aria-hidden="true">5.4.4.</strong> Path setup</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/commands/path-setup/clients.html"><strong aria-hidden="true">5.4.4.1.</strong> Clients</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/path-setup/connections.html"><strong aria-hidden="true">5.4.4.2.</strong> Connections</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/path-setup/channels.html"><strong aria-hidden="true">5.4.4.3.</strong> Channels</a></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/commands/relaying/index.html"><strong aria-hidden="true">5.4.5.</strong> Relaying</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/commands/relaying/packets.html"><strong aria-hidden="true">5.4.5.1.</strong> Packet Messages</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/relaying/handshakes.html"><strong aria-hidden="true">5.4.5.2.</strong> Handshake Messages</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/relaying/clear.html"><strong aria-hidden="true">5.4.5.3.</strong> Clearing Packets</a></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/commands/listen/index.html"><strong aria-hidden="true">5.4.6.</strong> Listen mode</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/upgrade/index.html"><strong aria-hidden="true">5.4.7.</strong> Client upgrade</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/commands/upgrade/test.html"><strong aria-hidden="true">5.4.7.1.</strong> Testing client upgrade</a></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/commands/misbehaviour/index.html"><strong aria-hidden="true">5.4.8.</strong> Misbehaviour</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/queries/index.html"><strong aria-hidden="true">5.4.9.</strong> Queries</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/commands/queries/client.html"><strong aria-hidden="true">5.4.9.1.</strong> Client</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/queries/connection.html"><strong aria-hidden="true">5.4.9.2.</strong> Connection</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/queries/channel.html"><strong aria-hidden="true">5.4.9.3.</strong> Channel</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/queries/packet.html"><strong aria-hidden="true">5.4.9.4.</strong> Packet</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/queries/tx.html"><strong aria-hidden="true">5.4.9.5.</strong> Tx</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/queries/transfer.html"><strong aria-hidden="true">5.4.9.6.</strong> Transfer</a></li></ol></li><li class="chapter-item expanded "><a href="../../documentation/commands/tx/index.html"><strong aria-hidden="true">5.4.10.</strong> Transactions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../../documentation/commands/tx/connection.html"><strong aria-hidden="true">5.4.10.1.</strong> Connection</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/tx/channel-open.html"><strong aria-hidden="true">5.4.10.2.</strong> Channel Open</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/tx/channel-close.html"><strong aria-hidden="true">5.4.10.3.</strong> Channel Close</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/tx/packet.html"><strong aria-hidden="true">5.4.10.4.</strong> Packet</a></li><li class="chapter-item expanded "><a href="../../documentation/commands/tx/upgrade.html"><strong aria-hidden="true">5.4.10.5.</strong> Upgrade</a></li></ol></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../../glossary.html"><strong aria-hidden="true">6.</strong> Glossary</a></li><li class="spacer"></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Hermes (IBC Relayer CLI) Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="hermes-versus-appsdktendermint-configuration"><a class="header" href="#hermes-versus-appsdktendermint-configuration">Hermes versus App/SDK/Tendermint Configuration</a></h1>
<p>This table summarizes the different configuration parameter combinations that may cause Hermes to raise errors. It gives some information on the failure type and refers to the relevant section of the guide for more information.
Following notations are used:</p>
<ul>
<li><code>tendermint.&lt;parameter&gt;</code>: 
<ul>
<li><code>tendermint</code> refers to the Tendermint configuration file <code>config.toml</code></li>
<li><code>&lt;parameter&gt;</code> refers to the parameter in this file.</li>
</ul>
</li>
<li><code>app.&lt;parameter&gt;</code>:
<ul>
<li><code>app</code> refers to the application configuration file <code>app.toml</code></li>
<li><code>&lt;parameter&gt;</code> refers to the parameter in this file.</li>
</ul>
</li>
<li><code>genesis.&lt;parameter&gt;</code>:</li>
<li><code>genesis</code> refers to the application configuration file <code>genesis.json</code></li>
<li><code>&lt;parameter&gt;</code> refers to the parameter in this file.</li>
</ul>
<p><strong>Hermes vs other configuration parameters that may cause Hermes failures</strong></p>
<div class="table-wrapper"><table><thead><tr><th>Hermes</th><th>Other</th><th>Details</th></tr></thead><tbody>
<tr><td><code>sequential_batch_tx = false</code></td><td><code>tendermint.recheck = false</code></td><td><a href="#recheck"><code>Mismatch</code><br/><code>(expected &lt; got)</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td><code>gas_price = x</code></td><td><code>app.minimum-gas-prices = y, </code><br/><code>with x &lt; y</code></td><td><a href="#minimum-gas-price"><code>Insufficient fees</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td><code>gas_price = x</code> <br/> <code>gas_multipler = 1.0</code></td><td><code>app.minimum-gas-prices = x</code></td><td><a href="#out-of-gas"><code>Out of gas</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td><code>max_tx_size = x</code></td><td><code>tendermint.max_tx_bytes = y,</code><br/><code>with x &lt; y</code></td><td><a href="#maximum-tx-size"><code>Tx too large</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td></td><td><code>07-tendermint not in</code><br/><code>genesis.app_state</code><br/><code>.ibc.client_genesis.params</code><br/><code>.allowed_clients</code></td><td><a href="#allowed-clients"><code>Client not </code><br/><code>allowed</code><br/><code>(07-tendermint)</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td><code>during connection creation</code></td><td><code>genesis.app_state</code><br/><code>.staking.params</code><br/><code>.historical_entries  = 0</code></td><td><a href="#historical-entries"><code>No historical info</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td><code>ref_chain.clock_drift +&lt;br/&gt;tgt_chain.clock_drift +</code><br/><code>tgt_chain.max_block_time</code><br/> <code>= x</code></td><td><code>tendermint.consensus.* =&gt; y block time,</code><br/><code>with x &lt; y</code></td><td><a href="#header-in-the-future"><code>Header in the future</code> </a></td></tr>
<tr><td></td><td></td><td></td></tr>
<tr><td><code>max_block_delay = x</code></td><td><code>genesis.app_state</code><br/><code>.ibc.connection_genesis.params</code><br/><code>.max_expected_time_per_block = y</code><br/><code>with x &lt; y</code></td><td><a href="#block-delay-not-reached"><code>Block delay not reached</code></a></td></tr>
<tr><td></td><td></td><td></td></tr>
</tbody></table>
</div>
<h2 id="recheck"><a class="header" href="#recheck">Recheck</a></h2>
<p>When relaying packets, Hermes may send up multiple transactions to the full node's mempool. Hermes uses the  <code>broadcast_tx_sync</code> RPC which does some basic verification and then returns the Tx hash back. </p>
<p>Unless configured with <code>sequential_batch_tx = true</code>, Hermes does not wait for a transaction to be included in a block before sending the next transaction. For this to be possible, Hermes keeps track of the account sequence number locally, incrementing it after each succesfull <code>broadcast_tx_sync</code> RPC.</p>
<p>During peak periods, it is possible that not all Tx-es in the mempool are included in a block. In order for new transactions to be accepted along with the pending Tx-es, the full node must be configured with <code>recheck = true</code>. Otherwise, Hermes may get the following error:</p>
<pre><code>2022-10-25T13:52:51.369822Z  WARN ThreadId(18) send_messages_and_wait_commit
  {chain=ibc-0 tracking_id=ft-transfer}:send_tx_with_account_sequence_retry{chain=ibc-0 account.sequence=88}: 
    failed to broadcast tx because of a mismatched account sequence number, refreshing account sequence number and 
      retrying once response=Response { code: Err(32), data: Data([]), log: Log(&quot;account sequence mismatch, 
        expected 69, got 88: incorrect account sequence&quot;), 
      hash: transaction::Hash(DFC53B04CE095CD045E4E89D7CEB095BF977B876FD8D3FB1A7F0AC288B58B9C4) }
</code></pre>
<h3 id="fix"><a class="header" href="#fix">Fix</a></h3>
<p>Ensure that the full node is configured with <code>recheck = true</code>.
This ensures that the mempool rechecks the Tx-es left in the mempool before accepting new incoming transactions, therefore maintaining the order of transactions.</p>
<h2 id="minimum-gas-price"><a class="header" href="#minimum-gas-price">Minimum Gas Price</a></h2>
<p>Hermes sends transactions using the <code>gas_price</code> parameter from the chain section in the Hermes <code>config.toml</code> configuration file. The full node will not accept any transactions with a gas price smaller than what is configured for the applications (<code>app.minimum-gas-prices</code>) and Hermes will log an <code>insufficient fees</code> error:</p>
<pre><code>2022-10-27T12:45:07.820543Z ERROR ThreadId(18) send_messages_and_wait_commit{chain=ibc-0 tracking_id=ft-transfer}:
  send_tx_with_account_sequence_retry{chain=ibc-0 account.sequence=48}: failed to broadcast tx with unrecoverable error
     response=Response { code: Err(13), data: Data([]), log: Log(&quot;insufficient fees; got: 99stake required: 198stake: insufficient fee&quot;), 
       hash: transaction::Hash(AFB9FE23DE9108D349B8679561D7F00DF00863749D7827C3972DFB391CF8E526) } 
         diagnostic=the price configuration for this chain may be too low! please check the `gas_price.price` Hermes config.toml
ERROR transfer error: tx response event consists of an error: check_tx (broadcast_tx_sync) on chain ibc-0 for 
  Tx hash AFB9FE23DE9108D349B8679561D7F00DF00863749D7827C3972DFB391CF8E526 reports error: 
    vcode=Err(13), log=Log(&quot;insufficient fees; got: 99stake required: 198stake: insufficient fee&quot;)
</code></pre>
<h3 id="fix-1"><a class="header" href="#fix-1">Fix</a></h3>
<p>Ensure that the <code>gas_price.price</code> parameter in the chain section of the Hermes <code>config.toml</code> configuration file is greater than or equal to the <code>app.minimum-gas-prices</code>.</p>
<h2 id="out-of-gas"><a class="header" href="#out-of-gas">Out of Gas</a></h2>
<p>Before Hermes sends a transaction, it estimates how much gas the transaction will require by calling the <code>SimulateTx()</code> gRPC. This returns the amount of gas that the Tx requires given the application state at the time of the call. It is possible that by the time the transaction is sent and checked by the application, the amount of gas required has increased. To help alleviate this, the gas estimation is adjusted upward by multiplying it by the <code>gas_multiplier</code> parameter: <code>gas_multiplier * simulated_gas</code>.</p>
<p>If the adjusted amount of gas ends up still being not enough for the transaction to be successfully submitted, e.g., the <code>gas_multiplier</code> parameter is set to <code>1.0</code> such that no adjustment is actually performed, Hermes returns the following error:</p>
<pre><code>ERROR transfer error: tx response event consists of an error: deliver_tx for 496835FF5A2F73F38ADA416506F7F1143BBD570E77217DC309CAD979924F0E70 reports error: code=Err(11), log=Log(&quot;out of gas in location: WriteFlat; gasWanted: 990000, gasUsed: 990724: out of gas&quot;)
</code></pre>
<h3 id="fix-2"><a class="header" href="#fix-2">Fix</a></h3>
<p>Ensure that the <code>gas_multiplier</code> parameter in the chain section of the Hermes <code>config.toml</code> configuration file is configured such that it allows some increase over the simulated gas. A good value is for example <code>1.1</code>.</p>
<h2 id="maximum-tx-size"><a class="header" href="#maximum-tx-size">Maximum Tx Size</a></h2>
<p>When Hermes relays packets or handshake messages, it will build multi-message Tx-es with up to <code>max_num_msgs</code> number of messages or up to a Tx size of <code>max_tx_size</code> bytes. The full node accepts only Tx-es with size up to the <code>max_tx_bytes</code> parameter in its <code>config.toml</code>. If a Tx is too large, the full node rejects them with the following error:</p>
<pre><code>2022-10-27T13:59:43.650251Z ERROR ThreadId(18) send_messages_and_wait_commit{chain=ibc-0 tracking_id=ft-transfer}:send_tx_with_account_sequence_retry{chain=ibc-0 account.sequence=159}: gas estimation failed or encountered another unrecoverable error error=RPC error to endpoint http://127.0.0.1:26657/: response error: Internal error: Tx too large. Max size is 500, but got 615 (code: -32603)
ERROR transfer error: failed while submitting the Transfer message to chain ibc-0: RPC error to endpoint http://127.0.0.1:26657/: response error: Internal error: Tx too large. Max size is 500, but got 615 (code: -32603)
</code></pre>
<h3 id="fix-3"><a class="header" href="#fix-3">Fix</a></h3>
<p>Ensure that the <code>max_tx_size</code> parameter configured for Hermes is smaller than the <code>max_tx_bytes</code> parameter configured for the full node.</p>
<h2 id="allowed-clients"><a class="header" href="#allowed-clients">Allowed Clients</a></h2>
<p>The SDK chain genesis file contains a list of allowed clients that can be created on a chain. If the chain is configured with <code>genesis.app_state.ibc.client_genesis.allowed_clients</code> that doesn't include <code>07-tendermint</code>, then the chain will not allow tendermint IBC clients to be created and Hermes cannot open an IBC connection with this chain. When attempting to create a client in this scenario, Hermes will get the following error:</p>
<pre><code>2022-10-27T14:48:04.632320Z ERROR ThreadId(35) send_messages_and_wait_commit{chain=ibc-0 tracking_id=create client}:send_tx_with_account_sequence_retry{chain=ibc-0 account.sequence=0}:estimate_gas: failed to simulate tx. propagating error to caller: gRPC call failed with status: status: Unknown, message: &quot;failed to execute message; message index: 0: client state type 07-tendermint is not registered in the allowlist: invalid client type [cosmos/ibc-go/v3@v3.0.0/modules/core/02-client/keeper/client.go:22] With gas wanted: '0' and gas used: '64671' &quot;, details: [], metadata: MetadataMap { headers: {&quot;content-type&quot;: &quot;application/grpc&quot;, &quot;x-cosmos-block-height&quot;: &quot;9&quot;} }
</code></pre>
<h3 id="fix-4"><a class="header" href="#fix-4">Fix</a></h3>
<p>Ensure that the <code>genesis.app_state.ibc.client_genesis.allowed_clients</code> parameter in the chain genesis file includes <code>07-tendermint</code>.</p>
<h2 id="historical-entries"><a class="header" href="#historical-entries">Historical Entries</a></h2>
<p>The presence of recent consensus states on a chain is required when processing some connection handshake messages, such as <code>MsgConnectionOpenTry</code> and <code>MsgConnectionOpenAck</code>. Such message types require proof verification that the counterparty chain has a valid client for this chain.
If the chain is configured with <code>genesis.app_state.staking.params.historical_entries = 0</code>, then the chain will not store historical consensus state information and Hermes cannot open IBC connections with this chain. It will report an error message which looks like this:</p>
<pre><code>2022-10-27T14:54:51.076598Z ERROR ThreadId(18) send_messages_and_wait_commit{chain=ibc-0 tracking_id=ConnectionOpenAck}:send_tx_with_account_sequence_retry{chain=ibc-0 account.sequence=6}:estimate_gas: failed to simulate tx. propagating error to caller: gRPC call failed with status: status: Unknown, message: &quot;failed to execute message; message index: 1: connection handshake open ack failed: self consensus state not found for height 0-88: no historical info found at height 88: not found [cosmos/ibc-go/v3@v3.0.0/modules/core/02-client/keeper/keeper.go:256] With gas wanted: '0' and gas used: '130807' &quot;, details: [], metadata: MetadataMap { headers: {&quot;content-type&quot;: &quot;application/grpc&quot;, &quot;x-cosmos-block-height&quot;: &quot;90&quot;} }
</code></pre>
<p>The chain genesis misconfiguration is caught when the health check runs, e.g. <code>hermes health-check</code>, <code>hermes start</code>. A warning message such as the following is printed:</p>
<pre><code>2022-10-27T15:00:14.583244Z  WARN ThreadId(40) health_check{chain=ibc-0}: Health checkup for chain 'ibc-0' failed
2022-10-27T15:00:14.583308Z  WARN ThreadId(40) health_check{chain=ibc-0}:     Reason: staking module for chain 'ibc-0' does not maintain any historical entries (`historical_entries` staking params is set to 0)
2022-10-27T15:00:14.583343Z  WARN ThreadId(40) health_check{chain=ibc-0}:     Some Hermes features may not work in this mode!
</code></pre>
<h3 id="fix-5"><a class="header" href="#fix-5">Fix</a></h3>
<p>Ensure that the <code>genesis.app_state.staking.params.historical_entries</code> parameter in the chain genesis file is greater than 0. Ideal values are &gt; 100.</p>
<h2 id="maximum-block-time"><a class="header" href="#maximum-block-time">Maximum Block Time</a></h2>
<p>There are two cases where misconfiguration of the maximum block time may cause Hermes to fail. They are described in the following sections.</p>
<h3 id="header-in-the-future"><a class="header" href="#header-in-the-future">Header in the Future</a></h3>
<p>When a client for chain <code>ref_chain</code> is created by Hermes on chain <code>tgt_chain</code>, its <code>max_clock_drift</code> is computed as:
<code>ref_chain.clock_drift + tgt_chain.clock_drift + tgt_chain.max_block_time</code>
Hermes may delay a client update with <code>header</code> for one block if it determines that sending it immediately would cause the chain to reject the update as being in the future.</p>
<p>Hermes sends the update in the case when <code>header.timestamp &lt;= dst_timestamp + max_clock_drift</code>
where <code>dst_timestamp</code> is the last block time on the destination chain.
Otherwise, it waits for the next block and retries the update. If the check fails again, an error is returned:</p>
<pre><code>2022-10-28T08:42:37.423739Z  WARN ThreadId(01) foreign_client.build_update_client_and_send{client=ibc-1-&gt;ibc-0:07-tendermint-0 target_query_height=latest height}:foreign_client.wait_and_build_update_client_with_trusted{client=ibc-1-&gt;ibc-0:07-tendermint-0 target_height=1-2182}:foreign_client.build_update_client_with_trusted{client=ibc-1-&gt;ibc-0:07-tendermint-0 target_height=1-2182}:foreign_client.wait_for_header_validation_delay{client=ibc-1-&gt;ibc-0:07-tendermint-0}: src header Timestamp(2022-10-28T08:42:35.600792Z) is after dst latest header Timestamp(2022-10-28T08:42:17.864603Z) + client state drift 3s,wait for next height on ibc-0
ERROR foreign client error: update header from ibc-1 with height 1-2182 and time Timestamp(2022-10-28T08:42:35.600792Z) is in the future compared with latest header on ibc-0 with height 0-4 and time Timestamp(2022-10-28T08:42:31.09872Z), adjusted with drift 3s
</code></pre>
<h3 id="block-delay-not-reached"><a class="header" href="#block-delay-not-reached">Block Delay not Reached</a></h3>
<p>An IBC packet sent to the channel end on a destination chain with <code>max_block_delay</code>, channel using a connection with <code>delay</code>, must be received:</p>
<ul>
<li>after the time delay: <code>delay</code> has elapsed relative to the block time that included the client update with the packet commitment root, and</li>
<li>after the block delay: <code>delay / max_block_delay</code> blocks on the destination chain have been created since the client update with the packet commitment root.</li>
</ul>
<p>The on-chain packet handler uses <code>genesis.app_state.ibc.connection_genesis.params.max_expected_time_per_block</code> (in nanoseconds) when computing the block delay.
Hermes uses its config <code>max_block_delay</code> to compute the block delay.
If <code>max_block_delay &gt; genesis.app_state.ibc.connection_genesis.params.max_expected_time_per_block</code>, then Hermes may send a packet that is received too early on the destination chain, resulting in an error like the following:</p>
<pre><code>ERROR link error: link failed with underlying error: gRPC call failed with status: status: Unknown, message: &quot;failed to execute message; message index: 0: receive packet verification failed: couldn't verify counterparty packet commitment: failed packet commitment verification for client (07-tendermint-1): cannot verify packet until height: 0-54, current height: 0-46: packet-specified delay period has not been reached [cosmos/ibc-go/v3@v3.0.0/modules/light-clients/07-tendermint/types/client_state.go:536] With gas wanted: '0' and gas used: '78238' &quot;, details: [], metadata: MetadataMap { headers: {&quot;content-type&quot;: &quot;application/grpc&quot;, &quot;x-cosmos-block-height&quot;: &quot;46&quot;} }
</code></pre>
<h3 id="fix-6"><a class="header" href="#fix-6">Fix</a></h3>
<p>To avoid errors for both cases described above:</p>
<ul>
<li>ensure that the <code>max_block_delay</code> parameter in the Hermes configuration file is equal to the <code>max_expected_time_per_block</code> parameter in the chain genesis file:</li>
</ul>
<pre><code>genesis.app_state.ibc.connection_genesis.params.max_expected_time_per_block
</code></pre>
<ul>
<li>ensure that the genesis <code>max_expected_time_per_block</code> parameter is 2 or 3 times the average block time which can be estimates from the <code>tendermint.consensus.timeout*</code> parameters. An example of a good estimation is:</li>
</ul>
<pre><code>       tendermint.consensus.timeout_propose +
       tendermint.consensus.timeout_prevote +
       tendermint.consensus.timeout_precommit +
       tendermint.consensus.timeout_commit
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../advanced/troubleshooting/inspect.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../../documentation/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../advanced/troubleshooting/inspect.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../../documentation/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="../../mermaid.min.js"></script>
        <script type="text/javascript" src="../../mermaid-init.js"></script>


    </body>
</html>
